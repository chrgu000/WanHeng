<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta http-equiv="x-ua-compatible" content="ie=7" />
		<meta http-equiv="x-ua-compatible" content="ie=9" />
		<meta name="format-detection" content="telephone=no" />
		<title>蒙台梭利</title>
		<link rel="stylesheet" href="../css/bootstrap.min.css">
		<link rel="stylesheet" href="../css/style.css">
		<link rel="stylesheet" href="../css/teacher_style.css">
		<link rel="stylesheet" type="text/css" href="../css/webuploader.css">
		<link rel="stylesheet" type="text/css" href="../css/diyUpload.css">
		<style type="text/css">
.loading {
	width: 100%;
	height: 100%;
	position: fixed;
	left: 0;
	top: 0;
	background: url(../img/loading.gif) no-repeat 0 center #fff;
	background-size: 100% auto;
	opacity: 0.4;
	display: none;
	z-index: 9999;
}
</style>
	</head>
	<body>

		<div class="back">
			<div class="back_btn" onclick="goBack()">
				<img src="../img/left_icon.png" class="img-responsive"/>
			</div>
			<div class="back_center"></div>
			<div class="back_right"></div>
		</div>
		<form action="../../style/addStyle.do" method="post" id="form">
			<div class="pic class_write">
				<input type="hidden" name="imgUrl" id="imgUrl">
				<input type="text" name="title" id="title" placeholder="请输入文章标题" style="font-size: 16px;">
				<textarea rows="8" name="content" id="content"
					placeholder="请输入内容..."></textarea>
			</div>
			<div class="pic">
				<div id="box">
					<div id="test" style="margin-top:-180px"></div>
				</div>
			</div>
			<div class="pic class_write">
				<input type="button" value="提交" class="tijiao" onclick="save()">
				<div>
					<div>
		</form>

		<script src="../js/jquery.min.js">
</script>
		<script src="../js/vue.min.js">
</script>
		<script src="../js/data.js">
</script>
		<script src="../js/style.js">
</script>
		<script type="text/javascript" language="javascript"
			src="../../static/common/getQueryString.js">
</script>
<script src="../js/jquery.js">
</script>
		<script type="text/javascript" src="../js/diyUpload.js">
</script>
		<script type="text/javascript"
			src="../js/webuploader.html5only.min.js">
</script>
		<script type="text/javascript" src="../../static/LD.sot/core.js">
</script>
		<script type="text/javascript" src="../../static/LD.sot/jquery.sot.js">
</script>
		<script type="text/javascript"
			src="../../static/LD.sot/pop.ups/init.js">
</script>
		<script src="../js/teacher_cookie.js">
</script>

		<script src="../js/ajaxfileupload.js">
</script>
<script src="../../static/common/jquery.form.js">
</script>
		<script type="text/javascript">
//选择图片，马上预览  
function xmTanUploadImg(obj) {
	$("#imgboxid").html('');
	var fl = obj.files.length;
	for ( var i = 0; i < fl; i++) {
		var file = obj.files[i];
		var reader = new FileReader();

		//读取文件过程方法  

		reader.onloadstart = function(e) {
			console.log("开始读取....");
		}
		reader.onprogress = function(e) {
			console.log("正在读取中....");
		}
		reader.onabort = function(e) {
			console.log("中断读取....");
		}
		reader.onerror = function(e) {
			console.log("读取异常....");
		}
		reader.onload = function(e) {
			console.log("成功读取....");

			var imgstr = '<img style="width:64px;height:64px;" src="' + e.target.result + '"/>';
			var oimgbox = document.getElementById("imgboxid");
			var ndiv = document.createElement("div");

			ndiv.innerHTML = imgstr;
			ndiv.className = "img-div";
			oimgbox.appendChild(ndiv);

		}

		reader.readAsDataURL(file);
		//alert(1);  
	}

}
var imgUrl="";
var n=0;
var flag=true;
$('#test').diyUpload( {
	url : '../../UploadFile.do',
	success : function(data) {
		n++;
		 imgUrl+=data._raw;
        var num=$(".fileBoxUl li").length;
        if(num==n){
        	$.pop.tips("成功上传图片");
        	$("#imgUrl").val(imgUrl);
        	flag=false;
        }
	},
	error : function(err) {
		console.info(err);
	}
});

function ajaxFileUpload() {
	if (!$("#imgboxid").html().trim()) {
		$.pop.tips("请选择照片");
		return false;
	} else {
		$.pop.load(true, "上传中...");
		$.ajaxFileUpload( {
			url : '../../UploadFile.do',// servlet请求路径 
			type : "post",
			secureuri : false,
			fileElementId : 'path',// 上传控件的id  
			dataType : 'text',
			success : function(data, status) {
				$.pop.load(false, null);
				if (data == "error") {
					newaddress.ealert("文件非图片格式");
					return false;
				} else {
					$("#imgUrl").val(data);
					return true;
				}
			},
			error : function(data, status, e) {
				return false;
			}
		});
		return true;
	}
}
function save() {
		$("#form").submit();
}
$("#form").ajaxForm( {
	dataType : 'json',
	beforeSend : function() {
		//表单提交前做表单验证
	return check();
},
success : function(data) {
	if (data.hasError) {
		$.pop.tips(data.errInfo);
	} else {
		$.pop.tips(data.errInfo);
		setTimeout(function() {
			location.href = "class_style.html"
		}, 500);
	}
},
error : function() {
}
});
function check() {
	var title = $("#title").val();
	if (!title) {
		$.pop.tips("请输入标题");
		return false;
	}
	var content = $("#content").val();
	if (!content) {
		$.pop.tips("请输入文章内容");
		return false;
	}
	var imgUrl = $("#imgUrl").val();
	if (!imgUrl||flag) {
		$.pop.tips("请上传图片");
		return false;
	}
}
</script>

	</body>
</html>